<!DOCTYPE html>
<html lang="en" manifest="manifest.appcache" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <title>InstaBail</title>
    <meta name="viewport" content="width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="InstaBail">

    <meta name="description" content="An app to help you instantly bail on your mates">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@shutdownscanner">
    <meta name="twitter:title" content="InstaBail">
    <meta name="twitter:description" content="An app to help you instantly bail on your mates" />
    <meta name="twitter:image" content="https://instabail.uk/android-icon-192x192.png" />

    <meta property="og:title" content="InstaBail" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="An app to help you instantly bail on your mates" />
    <meta property="og:image" content="https://instabail.uk/android-icon-192x192.png" />
    <meta property="og:url" content="https://instabail.uk" />

    <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="InstaBail.min.css" />
    <link rel="stylesheet" href="jquery.mobile.icons.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.structure.min.css" rel="stylesheet" />
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js', { scope: './' });
        }
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.4.5/jquery.mobile.min.js"></script>
</head>
<body>
    <div data-role="page" id="home">
        <div data-role="header" data-position="fixed">
            <a data-icon="heart" href="#love" data-prefetch="true" data-transition="flip" data-direction="reverse">Love</a>
            <h1>InstaBail</h1>
            <a data-icon="info" data-iconpos="right" href="#about" data-prefetch="true" data-transition="flip">Info</a>
        </div>
        <div data-role="content">
            <div style="height: 100px; text-align: center;">
                <img src="android-icon-192x192.png" alt="InstaBail" width="96" />
            </div>
            <textarea rows="4" name="textArea" id="textArea" style="height: 100px !important;"></textarea>
            <p>
                <a href="#" data-role="button" data-icon="refresh" data-iconpos="right" id="bailBtn">Generate a new bail!</a>
            </p>
            <p>&nbsp;</p>
            <p>
                <a href="mailto:" data-role="button" data-icon="mail" data-iconpos="right" id="emailBtn">Send as email</a>
            </p>
            <p>
                <a href="sms:" data-role="button" data-icon="comment" data-iconpos="right" id="smsBtn">Send as SMS</a>
            </p>
            <p>
                <a href="whatsapp:" data-role="button" data-icon="phone" data-iconpos="right" id="waBtn">Send with WhatsApp</a>
            </p>
            <p>
                <a href="https://twitter.com/intent/tweet" data-role="button" data-icon="action" data-iconpos="right" id="twitBtn">Tweet on Twitter</a>
            </p>
        </div>
    </div>

    <div data-role="page" id="about">
        <div data-role="header" data-position="fixed">
            <h1>About InstaBail</h1>
            <a data-icon="home" data-iconpos="right" href="#home" data-prefetch="true" data-transition="flip" class="ui-btn-right" data-rel="back">Home</a>
        </div>
        <div data-role="content">
            <p>
                InstaBail is a fun offline mobile web app that generates random excuses (bails) and easily lets you share them.
                It uses real-time train delay information for more realistic bails.
            </p>
            <a href="https://unop.uk" data-role="button" target="_blank">Read more on my blog</a>
            <p>Tweet to me with your ideas for more bails!</p>
            <a href="https://twitter.com/shutdownscanner" data-role="button" target="_blank">Follow me on Twitter</a>
            <p>If you like mobile web apps then you should definitely check out Yo Flow, my app for gyms and personal trainers to induct new clients.</p>
            <a href="https://yoflow.uk" data-role="button" target="_blank">Check out Yo Flow</a>
            <p>InstaBail uses the TfL API and my Huxley project to proxy live railway departure data.</p>
            <a href="https://github.com/jpsingleton/Huxley" data-role="button" target="_blank">View Huxley on GitHub</a>
            <p>It also checks for any current tube strikes.</p>
            <a href="https://isthetubeonstrike.com" data-role="button" target="_blank">IsTheTubeOnStrike.com</a>
            <p>Thanks to Lorna for the idea and Wing for a lot of the inspiration behind various bails!</p>
            <div style="text-align: center;">♥</div>
        </div>
    </div>

    <div data-role="page" id="love">
        <div data-role="header" data-position="fixed">
            <a data-icon="home" href="#home" data-prefetch="true" data-transition="flip">Home</a>
            <h1>InstaBail</h1>
        </div>
        <div data-role="content">
            <div style="text-align: center;">
                Love you too!
                <div style="font-size: 11em;">
                    ♥
                </div>
                <p>Please help spread the word about InstaBail by sharing it with your friends!</p>
            </div>
            <p>
                <a href="mailto:?subject=I love InstaBail!&body=I love InstaBail! An app to help you instantly bail on your mates with comedy excuses. - https://instabail.uk" data-role="button" data-icon="mail" data-iconpos="right">Share by email</a>
            </p>
            <p>
                <a href="sms:?body=I love InstaBail! An app to help you instantly bail on your mates with comedy excuses. - https://instabail.uk" data-role="button" data-icon="comment" data-iconpos="right">Share by SMS</a>
            </p>
            <p>
                <a href="whatsapp://send?text=I love InstaBail! An app to help you instantly bail on your mates with comedy excuses. - https://instabail.uk" data-role="button" data-icon="phone" data-iconpos="right">Share on WhatsApp</a>
            </p>
            <p>
                <a href="https://twitter.com/intent/tweet?text=InstaBail! An app to help you instantly bail on your mates with comedy excuses.&url=https%3A%2F%2Finstabail.uk&hashtags=InstaBail&via=shutdownscanner&related=yoflowuk" data-role="button" data-icon="action" data-iconpos="right">Share on Twitter</a>
            </p>
            <p>
                <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finstabail.uk&t=InstaBail" data-role="button" data-icon="action" data-iconpos="right">Share on Facebook</a>
            </p>
            <p>
                You should add this app to your home screen!
                Simply press the share/menu button in the browser toolbar then press "Add to Home Screen".
                If you launch the app from there it will run full screen.
                It even works offline (but you won't get all the bails without internet).
            </p>
        </div>
    </div>

    <script type="text/javascript">

        var bails = [
            "leaves on the line",
            "being a lazy waste cadet",
            "getting very drunk last night",
            "wanting to stay in bed",
            "the state of the economy",
            "losing my phone and/or wallet",
            "extenuating circumstances",
            "getting a better offer",
            "the wrong type of snow",
            "taking a pregnant stranger to hospital",
            "being attacked by a badger/fox",
            "the ongoing conflict in the Middle East",
            "NSA/GCHQ surveillance",
            "ecumenical matters",
            "operational concerns",
            "the fact that WINTER IS COMING",
            "watching cats on YouTube",
            "cooking crystal",
            "getting locked in a pub toilet",
            "being burnt by the Fenchurch Street death ray",
            "my cats breaking the webcam that I use to check up on them",
            "making dim sum",
            "my housemate being in the shower",
            "Google maps saying the venue was in the wrong place",
            "Ed Balls",
            "a previous delay",
            "jetlag from my trip to Portugal",
            "#IndustrialAction"
        ];

        $.mobile.ajaxEnabled = false;
        $("#bailBtn").on("click", generateBail);
        generateBail();

        function generateBail() {
            var bail = "Really sorry, can't make it today due to " + bails[Math.floor(Math.random() * bails.length)] + ". See you soon! :)";

            var sendBail = encodeURIComponent(bail + " - https://instabail.uk");
            $("#emailBtn").attr("href", "mailto:?subject=Sorry!&body=" + sendBail);
            $("#smsBtn").attr("href", "sms:?body=" + sendBail);
            $("#waBtn").attr("href", "whatsapp://send?text=" + sendBail);
            $("#twitBtn").attr("href", "https://twitter.com/intent/tweet?text=" + sendBail + "&related=shutdownscanner");

            $("#textArea").val(bail);
        }

        $.get("https://api.tfl.gov.uk/line/mode/tube,overground,dlr,tflrail,tram,national-rail,cable-car,river-bus,river-tour/status", function (lines) {
            $.each(lines, function (lineIndex, line) {
                $.each(line.lineStatuses, function (lineStatusIndex, lineStatus) {
                    if (lineStatus.statusSeverity !== 10) {
                        var lineName = line.name;
                        if (line.modeName === "tube") {
                            lineName = "the " + lineName + " line";
                        }
                        if (line.modeName === "dlr" || line.id === "woolwich-ferry") {
                            lineName = "the " + lineName;
                        }
                        var bail = lineStatus.statusSeverityDescription.toLowerCase() + " on " + lineName;
                        if (bails.indexOf(bail) === -1) { // Only add if not present to avoid duplicates
                            bails.push(bail);
                            return false; // Break so only one bail from each line
                        }
                    }
                });
            });
        });

        function railBails(origin) {
            $.get("https://huxley.apphb.com/delays/" + origin + "/to/London/50?accessToken=DA1C7740-9DA0-11E4-80E6-A920340000B1", function (resp) {
                if (resp.delays) {
                    bails.push("train delays between " + resp.locationName + " and " + resp.filterLocationName);
                }
            });
        }

        railBails("Clapham Junction");
        railBails("Tunbridge Wells");
        railBails("Birmingham New Street");

        $.get("https://instabail.uk/bails.json", function (resp) {
            Array.prototype.push.apply(bails, resp);
        });

        $.get("https://isthetubeonstrike.com/api.json", function (resp) {
            $.each(resp.strikes, function (strikeIndex, strike) {
                var now = new Date();
                if (now > new Date(strike.start) && now < new Date(strike.end)) {
                    bails.push("a strike on the tube");
                    return false;
                }
            });
        });

    </script>
</body>
</html>
